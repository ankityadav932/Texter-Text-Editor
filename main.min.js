class Texter{static#e="â€‹";static#t="&#8203;";#n=!0;#i=null;#l=null;#r=null;#a=[];#s=null;#o=null;#d=null;#c=null;#h={selectionType:{emptySelection:0,singleLineSelection:1,multilineSelection:2},featureType:{inlineFeature:1,newLineFeature:2,customFeature:3,stylingFeature:4},elementType:{inline:1,block:2}};#m={p:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-paragraph" viewBox="0 0 16 16">\n\t\t\t  <path d="M10.5 15a.5.5 0 0 1-.5-.5V2H9v12.5a.5.5 0 0 1-1 0V9H7a4 4 0 1 1 0-8h5.5a.5.5 0 0 1 0 1H11v12.5a.5.5 0 0 1-.5.5z"/>\n\t\t\t</svg>\n\t\t',h1:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-type-h1" viewBox="0 0 16 16">\n\t\t\t  <path d="M8.637 13V3.669H7.379V7.62H2.758V3.67H1.5V13h1.258V8.728h4.62V13h1.259zm5.329 0V3.669h-1.244L10.5 5.316v1.265l2.16-1.565h.062V13h1.244z"/>\n\t\t\t</svg>\n\t\t',h2:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-type-h2" viewBox="0 0 16 16">\n\t\t\t  <path d="M7.638 13V3.669H6.38V7.62H1.759V3.67H.5V13h1.258V8.728h4.62V13h1.259zm3.022-6.733v-.048c0-.889.63-1.668 1.716-1.668.957 0 1.675.608 1.675 1.572 0 .855-.554 1.504-1.067 2.085l-3.513 3.999V13H15.5v-1.094h-4.245v-.075l2.481-2.844c.875-.998 1.586-1.784 1.586-2.953 0-1.463-1.155-2.556-2.919-2.556-1.941 0-2.966 1.326-2.966 2.74v.049h1.223z"/>\n\t\t\t</svg>\n\t\t',h3:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-type-h3" viewBox="0 0 16 16">\n\t\t\t  <path d="M7.637 13V3.669H6.379V7.62H1.758V3.67H.5V13h1.258V8.728h4.62V13h1.259zm3.625-4.272h1.018c1.142 0 1.935.67 1.949 1.674.013 1.005-.78 1.737-2.01 1.73-1.08-.007-1.853-.588-1.935-1.32H9.108c.069 1.327 1.224 2.386 3.083 2.386 1.935 0 3.343-1.155 3.309-2.789-.027-1.51-1.251-2.16-2.037-2.249v-.068c.704-.123 1.764-.91 1.723-2.229-.035-1.353-1.176-2.4-2.954-2.385-1.873.006-2.857 1.162-2.898 2.358h1.196c.062-.69.711-1.299 1.696-1.299.998 0 1.695.622 1.695 1.525.007.922-.718 1.592-1.695 1.592h-.964v1.074z"/>\n\t\t\t</svg>\n\t\t',boldText:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-type-bold" viewBox="0 0 16 16">\n\t\t\t\t<path d="M8.21 13c2.106 0 3.412-1.087 3.412-2.823 0-1.306-.984-2.283-2.324-2.386v-.055a2.176 2.176 0 0 0 1.852-2.14c0-1.51-1.162-2.46-3.014-2.46H3.843V13H8.21zM5.908 4.674h1.696c.963 0 1.517.451 1.517 1.244 0 .834-.629 1.32-1.73 1.32H5.908V4.673zm0 6.788V8.598h1.73c1.217 0 1.88.492 1.88 1.415 0 .943-.643 1.449-1.832 1.449H5.907z"/>\n\t\t\t</svg>\n\t\t',italicText:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-type-italic" viewBox="0 0 16 16">\n\t\t\t  <path d="M7.991 11.674 9.53 4.455c.123-.595.246-.71 1.347-.807l.11-.52H7.211l-.11.52c1.06.096 1.128.212 1.005.807L6.57 11.674c-.123.595-.246.71-1.346.806l-.11.52h3.774l.11-.52c-1.06-.095-1.129-.211-1.006-.806z"/>\n\t\t\t</svg>\n\t\t',underlinedText:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-type-underline" viewBox="0 0 16 16">\n\t\t\t  <path d="M5.313 3.136h-1.23V9.54c0 2.105 1.47 3.623 3.917 3.623s3.917-1.518 3.917-3.623V3.136h-1.23v6.323c0 1.49-.978 2.57-2.687 2.57-1.709 0-2.687-1.08-2.687-2.57V3.136zM12.5 15h-9v-1h9v1z"/>\n\t\t\t</svg>\n\t\t',unorderedlists:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-list-task" viewBox="0 0 16 16">\n\t\t\t  <path fill-rule="evenodd" d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5H2zM3 3H2v1h1V3z"/>\n\t\t\t  <path d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9z"/>\n\t\t\t  <path fill-rule="evenodd" d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5V7zM2 7h1v1H2V7zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5H2zm1 .5H2v1h1v-1z"/>\n\t\t\t</svg>\n\t\t',orderedlists:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-list-ol" viewBox="0 0 16 16">\n\t\t\t  <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"/>\n\t\t\t  <path d="M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338v.041zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635V5z"/>\n\t\t\t</svg>\n\t\t',tables:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-table" viewBox="0 0 16 16">\n\t\t\t  <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"/>\n\t\t\t</svg>\n\t\t',image:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">\n\t\t\t  <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>\n\t\t\t  <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>\n\t\t\t</svg>\n\t\t',alignLeft:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-text-left" viewBox="0 0 16 16">\n\t\t\t  <path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>\n\t\t\t</svg>\n\t\t',alignRight:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-text-right" viewBox="0 0 16 16">\n\t\t\t  <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-4-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm4-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-4-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>\n\t\t\t</svg>\n\t\t',alignCenter:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-text-center" viewBox="0 0 16 16">\n\t\t\t  <path fill-rule="evenodd" d="M4 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>\n\t\t\t</svg>\n\t\t',close:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">\n\t\t\t  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>\n\t\t\t  <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>\n\t\t\t</svg>\n\t\t',add:'\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16">\n\t\t\t  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>\n\t\t\t</svg>\n\t\t'};#p={p:{name:"P",class:"p-btn",type:this.#h.featureType.newLineFeature,content:this.#m.p,tooltip:"Paragraph"},h1:{name:"H1",class:"h1-btn",type:this.#h.featureType.newLineFeature,content:this.#m.h1,tooltip:"Big heading"},h2:{name:"H2",class:"h2-btn",type:this.#h.featureType.newLineFeature,content:this.#m.h2,tooltip:"Medium heading"},h3:{name:"H3",class:"h3-btn",type:this.#h.featureType.newLineFeature,content:this.#m.h3,tooltip:"Small heading"},D1:"divider",boldText:{name:"STRONG",class:"boldText-btn",type:this.#h.featureType.inlineFeature,content:this.#m.boldText,tooltip:"Bold text"},italicText:{name:"I",class:"italicText-btn",type:this.#h.featureType.inlineFeature,content:this.#m.italicText,tooltip:"Italic text"},underlinedText:{name:"U",class:"underlinedText-btn",type:this.#h.featureType.inlineFeature,content:this.#m.underlinedText,tooltip:"Underlined text"},D2:"divider",unorderedlists:{name:"UL",class:"unorderedlists-btn",type:this.#h.featureType.newLineFeature,content:this.#m.unorderedlists,tooltip:"Bullet list"},orderedlists:{name:"OL",class:"orderedlists-btn",type:this.#h.featureType.newLineFeature,content:this.#m.orderedlists,tooltip:"Numbered list"},D3:"divider",alignLeft:{name:"ALIGN-LEFT",styleCategory:"ALIGNMENT",class:"align-left-btn",type:this.#h.featureType.stylingFeature,styleClass:"align-left",content:this.#m.alignLeft,tooltip:"Align Left",level:this.#h.elementType.block},alignCenter:{name:"ALIGN-CENTER",styleCategory:"ALIGNMENT",class:"align-center-btn",type:this.#h.featureType.stylingFeature,styleClass:"align-center",content:this.#m.alignCenter,tooltip:"Align Center",level:this.#h.elementType.block},alignright:{name:"ALIGN-RIGHT",styleCategory:"ALIGNMENT",class:"align-right-btn",type:this.#h.featureType.stylingFeature,styleClass:"align-right",content:this.#m.alignRight,tooltip:"Align Right",level:this.#h.elementType.block},D4:"divider",tables:{name:"TABLE",class:"tables-btn",type:this.#h.featureType.customFeature,content:this.#m.tables,tooltip:"Table"},image:{name:"IMG",class:"image-btn",type:this.#h.featureType.customFeature,content:this.#m.image,tooltip:"Image"}};constructor(e){this.userConfig=e,this.createTextEditor()}getLastRange=()=>{if(!this.#c)return null;let e=document.createRange();return e.setStart(this.#c.startContainer,this.#c.startOffset),e.setEnd(this.#c.endContainer,this.#c.endOffset),this.#c.collapsed&&e.collapse(!0),e};clearLastSelection=()=>{window.getSelection().removeAllRanges(),this.#c=null};createTextEditor=()=>{this.#i=document.createElement("div"),this.#i.classList.add("texter"),this.#i.classList.add(this.userConfig.config.customClass),this.#i.style.width=this.userConfig.config.width,this.#l=document.createElement("div"),this.#l.classList.add("texter-option-menu");let e=document.createElement("div");e.classList.add("overflow-scroll");let t=document.createElement("div");t.classList.add("menu-panel");for(let e in this.#p){if("divider"==this.#p[e]){let e=document.createElement("span");e.classList.add("menu-divider"),t.appendChild(e);continue}let n=document.createElement("span");n.classList.add("first-level-item"),n.classList.add(this.#p[e].class),n.setAttribute("type","button"),n.setAttribute("feature-key",e),n.setAttribute("title",this.#p[e].tooltip),n.innerHTML=this.#p[e].content,t.appendChild(n)}e.appendChild(t),this.#l.appendChild(e),this.#r=document.createElement("div"),this.#r.classList.add("texter-text-editor"),this.#r.setAttribute("contenteditable","true"),this.#r.setAttribute("autofocus","true"),this.#r.style.height=this.userConfig.config.height,this.#i.appendChild(this.#l),this.#i.appendChild(this.#r),this.userConfig.element.insertAdjacentElement("afterend",this.#i),this.addTexterListeners()};addTexterListeners=()=>{document.querySelectorAll(".first-level-item svg").forEach((e=>{e.setAttribute("width","25"),e.setAttribute("height","25")})),document.execCommand("defaultParagraphSeparator",!1,"p"),this.#i.addEventListener("mouseup",(e=>{if(this.manageCustomFeatureOptions(e.target),this.manageMenuOptions(e.target),this.#r.contains(e.target)){this.setParagraphAsDefault(e);let t=window.getSelection();if(0==t.rangeCount)return;let n=t.getRangeAt(0);(this.#r==n.commonAncestorContainer||this.#r.contains(n.commonAncestorContainer))&&(this.#c={startContainer:n.startContainer,endContainer:n.endContainer,startOffset:n.startOffset,endOffset:n.endOffset,collapsed:n.collapsed},this.setActiveFeatures())}if(this.#l.contains(e.target)){this.#l.querySelectorAll("span.first-level-item").forEach((t=>{(t==e.target||t.contains(e.target))&&this.changeFeatureState(t.getAttribute("feature-key"))}))}}));["keyup","focusin"].forEach((e=>{this.#r.addEventListener(e,(e=>{this.setParagraphAsDefault(e);let t=window.getSelection();if(0==t.rangeCount)return;let n=t.getRangeAt(0);(this.#r==n.commonAncestorContainer||this.#r.contains(n.commonAncestorContainer))&&(this.#c={startContainer:n.startContainer,endContainer:n.endContainer,startOffset:n.startOffset,endOffset:n.endOffset,collapsed:n.collapsed},this.setActiveFeatures())}))})),this.#r.addEventListener("focusout",(e=>{console.log("OK")}))};createImageOptions=e=>{if(e.parentElement.querySelector("span.image-options"))return;let t=document.createElement("SPAN");t.contentEditable=!1,t.classList.add("image-options");let n=document.createElement("SPAN");n.classList.add("custom-feature-divider");let i=document.createElement("BUTTON");i.innerHTML=this.#m.alignLeft,i.setAttribute("feature","img-left"),i.setAttribute("title","Algin left"),t.appendChild(i);let l=document.createElement("BUTTON");l.innerHTML=this.#m.alignCenter,l.setAttribute("feature","img-center"),l.setAttribute("title","Align center"),t.appendChild(l);let r=document.createElement("BUTTON");r.innerHTML=this.#m.alignRight,r.setAttribute("feature","img-right"),r.setAttribute("title","Align right"),t.appendChild(r),t.appendChild(n.cloneNode(!0));let a=document.createElement("BUTTON");a.innerText="100%",a.setAttribute("feature","img-full"),a.setAttribute("title","Full size image"),t.appendChild(a);let s=document.createElement("BUTTON");s.innerText="50%",s.setAttribute("feature","img-half"),s.setAttribute("title","Half size image"),t.appendChild(s);let o=document.createElement("BUTTON");o.innerText="25%",o.setAttribute("feature","img-quarter"),o.setAttribute("title","Qauter size image"),t.appendChild(o),t.appendChild(n.cloneNode(!0));let d=document.createElement("BUTTON");d.innerHTML=this.#m.close,d.setAttribute("feature","img-close"),d.setAttribute("title","Remove image"),t.appendChild(d),e.insertAdjacentElement("afterend",t),this.addImageOptionListener(e,t)};addImageOptionListener=(e,t)=>{let n=this.mainElement(e,this.#h.elementType.block),i=e.parentElement,l=t.querySelectorAll("button");console.log(l);let r=e=>{["align-left","align-center","align-right"].forEach((e=>{n.classList.contains(e)&&n.classList.remove(e)})),n.classList.add(e),n.click()},a=t=>{["full","half","quarter"].forEach((e=>{i.classList.contains(e)&&i.classList.remove(e)})),i.classList.add(t),e.click()};l.forEach((e=>{let t=e.getAttribute("feature");if(t)switch(t){case"img-left":e.addEventListener("mouseup",(e=>r("align-left")));break;case"img-center":e.addEventListener("mouseup",(e=>r("align-center")));break;case"img-right":e.addEventListener("mouseup",(e=>r("align-right")));break;case"img-full":e.addEventListener("mouseup",(e=>a("full")));break;case"img-half":e.addEventListener("mouseup",(e=>a("half")));break;case"img-quarter":e.addEventListener("mouseup",(e=>a("quarter")));break;case"img-close":e.addEventListener("mouseup",(e=>{i.parentElement.removeChild(i),n.removeAttribute("class"),n.properText().length||n.parentElement.removeChild(n)}));break;default:console.error("Unknown Image option passed for adding event listener")}}))};manageCustomFeatureOptions=e=>{if(this.#d&&this.#d!=e&&!this.#d.contains(e)){switch(this.#o){case"IMG":for(;this.#d.nextSibling;)this.#d.parentElement.removeChild(this.#d.nextSibling);for(;this.#d.previousSibling;)this.#d.parentElement.removeChild(this.#d.previousSibling);break;case"TABLE":"SPAN"==this.#d.lastChild.nodeName&&this.#d.removeChild(this.#d.lastChild);break;default:console.error("Unknown custom feature passed for deactivation")}this.#d=null,this.#o=null}};manageMenuOptions=e=>{let t=document.querySelector("#item-sub-menu");t&&(e==t||t.contains(e)||t.parentElement.removeChild(t))};getElementType=e=>{if(!e)return;if(1!=e.nodeType)return console.error("Only HTML node will be accepted as parameter");return(e.currentStyle||window.getComputedStyle(e,"")).display};getElementPosition=e=>{const t=e.getBoundingClientRect(),n=e.offsetParent.getBoundingClientRect();let i=Math.abs(t.top-n.top);return{left:Math.abs(t.left-n.left)+window.scrollX,top:i+window.scrollY}};setParagraphAsDefault=e=>{let t=window.getSelection();if(0==t.rangeCount)return;t.getRangeAt(0);if(0==this.#r.properText().length&&0==this.#r.childNodes.length){let e=document.createElement("p");e.appendChild(document.createElement("br")),this.#r.appendChild(e);let n=document.createRange();n.setStart(e.firstChild,0),n.collapse(!0),t.removeAllRanges(),t.addRange(n)}};unNestElements=(e,t,n,i)=>{if(![1,3].includes(e.nodeType))return console.error("Node of unknown type has been passed for un-nesting");if(1==e.nodeType){if(e.properText()&&e.properText().length)return console.error("Non empty HTML node has been passed for un-nesting");{let n=document.createTextNode(Texter.#e);e.appendChild(n),e=n,t=0}}let l=document.createTextNode(e.nodeValue.slice(0,t)),r=document.createTextNode(e.nodeValue.slice(t)),a=[],s=[],o=[],d=e;for(;d=d.previousSibling;)s.unshift(d);for(d=e;d=d.nextSibling;)o.push(d);e.parentElement.setAttribute("target-node","true");let c=e.parentElement;if(a.push(c.nodeName.toUpperCase()),n)for(;c.nodeName!=n;)c=c.parentElement,a.push(c.nodeName.toUpperCase());else{if(!i)return console.error("Either tagName or targetElement is required for un-nesting HTML elements");for(;c!=i;)c=c.parentElement,a.push(c.nodeName.toUpperCase())}let h=c.cloneNode(!0),m=c.cloneNode(!0),p=h.hasAttribute("target-node")?h:h.querySelector("[target-node]");for(;p.firstChild;)p.removeChild(p.firstChild);for(d of s)p.appendChild(d);for(p.appendChild(l),p.removeAttribute("target-node");p!=h;){for(;p.nextSibling;)p.parentElement.removeChild(p.nextSibling);p=p.parentElement}for(p=m.hasAttribute("target-node")?m:m.querySelector("[target-node]");p.firstChild;)p.removeChild(p.firstChild);for(d of(p.appendChild(r),o))p.appendChild(d);for(p.removeAttribute("target-node");p!=m;){for(;p.previousSibling;)p.parentElement.removeChild(p.previousSibling);p=p.parentElement}let u=document.createTextNode(Texter.#e),f=c.parentElement;return m.properText()&&m.properText().length?(f.replaceChild(m,c),f.insertBefore(u,m)):f.replaceChild(u,c),h.properText()&&h.properText().length&&f.insertBefore(h,u),{focusNode:u,nodeArray:a}};removeDuplicateTags=(e,t={})=>{if(1==e.nodeType){let n=e.nodeName;if(n in t?t[n]++:t[n]=1,e.childNodes.length)for(let n of e.childNodes)this.removeDuplicateTags(n,t);if(n in t&&t[n]>1){let t=e.parentElement;for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}t[n]--}};insertInlineTag=e=>{let t=this.getLastRange();if(!t)return!1;if(t.collapsed){let n=document.createElement(e),i=t.startContainer,l=1==i.nodeType?i:i.parentElement;this.mainElement(l,this.#h.elementType.block);if(n.appendChild(document.createTextNode(Texter.#e)),3==i.nodeType){if(i.properText().length){let e=document.createTextNode(i.nodeValue.slice(0,t.startOffset)),n=document.createTextNode(i.nodeValue.slice(t.startOffset));l.insertBefore(e,i),i.nextSibling?l.insertBefore(n,i.nextSibling):l.appendChild(n)}l.replaceChild(n,i)}else if(1==i.nodeType){if("BR"==i.nodeName){let e=i;i=i.parentElement,i.removeChild(e)}i.childNodes.length?i.insertBefore(n,i.firstChild):i.appendChild(n)}else console.error("Unknown element in range");this.setCaretPosition(n.firstChild,1),this.setActiveFeatures()}else if(t.startContainer==t.endContainer){let n=document.createElement(e),i=t.startContainer,l=i.parentElement,r=document.createTextNode(i.nodeValue.slice(0,t.startOffset)),a=document.createTextNode(i.nodeValue.slice(t.startOffset,t.endOffset)),s=document.createTextNode(i.nodeValue.slice(t.endOffset));n.appendChild(a),l.insertBefore(r,i),i.nextSibling?l.insertBefore(s,i.nextSibling):l.appendChild(s),l.replaceChild(n,i)}else{let n=t.commonAncestorContainer,i=t.startContainer,l=t.startOffset,r=i.parentElement,a=document.createTextNode(i.nodeValue.slice(0,l)),s=document.createTextNode(i.nodeValue.slice(l)),o=document.createElement(e),d=o;if(o.appendChild(s),r.replaceChild(o,i),r.insertBefore(a,o),r=o,r!=n)for(;r.parentElement!=n;){let t=r.parentElement;for(r=r.nextSibling;r;){let n=r;if(r=r.nextSibling,n.properText()&&n.properText().length){let i=this.getElementType(n);if(o=document.createElement(e),"inline"==i){let e=n.cloneNode(!0);o.appendChild(e),t.replaceChild(o,n)}else{for(;n.firstChild;)o.appendChild(n.firstChild);n.appendChild(o)}}else n.parentElement.removeChild(n)}r=t}let c=r;if(i=t.endContainer,l=t.endOffset,r=i.parentElement,a=document.createTextNode(i.nodeValue.slice(0,l)),s=document.createTextNode(i.nodeValue.slice(l)),o=document.createElement(e),o.appendChild(a),r.replaceChild(s,i),r.insertBefore(o,s),r=o,r!=n)for(;r.parentElement!=n;){let t=r.parentElement;for(r=r.previousSibling;r;){let n=r;if(r=r.previousSibling,n.properText()&&n.properText().length){if(o=document.createElement(e),"inline"==this.getElementType(n)){let e=n.cloneNode(!0);o.appendChild(e),t.replaceChild(o,n)}else{for(;n.firstChild;)o.appendChild(n.firstChild);n.appendChild(o)}}else n.parentElement.removeChild(n)}r=t}let h=r;if(c!=n&&h!=n)for(r=c.nextSibling;r&&r!=h;){let t=r;if(r=r.nextSibling,1==t.nodeType){let n=this.getElementType(t);if(o=document.createElement(e),"inline"!=n){for(;t.firstChild;)o.appendChild(t.firstChild);t.appendChild(o)}else if("inline"==n){let e=t.parentElement;o.appendChild(t.cloneNode(!0)),e.replaceChild(o,t)}else console.error("DOM element display type is out of config - "+n)}else if(3==t.nodeType){if(t&&t.properText().length){let n=t.parentElement;o=document.createElement(e),o.appendChild(t.cloneNode(!0)),n.replaceChild(o,t)}}else console.error("DOM node type is out of config - "+t.nodeType)}this.setCaretPosition(d.firstChild,0)}};mainElement=(e,t)=>{let n=this.#r,i=3==e.nodeType?e.parentElement:e;if(t==this.#h.elementType.block)for(;i;){let e=this.getElementType(i);if(i==n)return console.error("No block ancestor element found. Please report this issue"),null;if("inline"!=e&&i.parentElement==n)return i;i=i.parentElement}else{if(t!=this.#h.elementType.inline)return console.error("Exceptional value sent in type argument"),!1;for(;i;){let e=this.getElementType(i),t=this.getElementType(i.parentElement);if(i==n)return console.error("No block ancestor element found. Please report this issue"),null;if("inline"==e&&"inline"!=t)return i;i=i.parentElement}}};setCaretPosition=(e,t)=>{let n=document.createRange(),i=window.getSelection();n.setStart(e,t),n.collapse(!0),this.#c={startContainer:n.startContainer,endContainer:n.endContainer,startOffset:n.startOffset,endOffset:n.endOffset,collapsed:n.collapsed},i.removeAllRanges(),i.addRange(n)};generateString=()=>{let e="ID";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<10;n++)e+=t.charAt(Math.floor(62*Math.random()));return e};nodeTreeTagRemover=(e,t)=>{if(1==e.nodeType){if(e.childNodes.length){let n=e.firstChild;for(;n;){let e=n;n=n.nextSibling,this.nodeTreeTagRemover(e,t)}}e.nodeName;if(!e.properText()||!e.properText().length)return void e.parentElement.removeChild(e);if(t==e.nodeName){let t=e.parentElement;for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}}};removeInlineTag=e=>{let t=this.getLastRange();if(t.collapsed){let n=t.startContainer,i=t.startOffset,l=this.unNestElements(n,i,e,null),r=l.focusNode,a=r.parentElement,s=r.nextSibling,o=r;for(let t of this.#a)if(t.featureType==this.#h.featureType.inlineFeature&&t.nodeName!=e&&l.nodeArray.includes(t.nodeName.toUpperCase())){let e=document.createElement(t.nodeName);e.appendChild(o),o=e}s?a.insertBefore(o,s):a.appendChild(o),this.setCaretPosition(r,1),this.setActiveFeatures()}else if(t.startContainer==t.endContainer)console.log("Same element tag removal - To be developed");else{let n=t.commonAncestorContainer,i=this.getElementType(n),l=t.startContainer,r=document.createElement("SPAN"),a=t.startOffset,s=t.endContainer,o=document.createElement("SPAN"),d=t.endOffset;r.setAttribute("id","begin-node"),o.setAttribute("id","end-node"),r.appendChild(l.cloneNode(!0)),o.appendChild(s.cloneNode(!0)),l.parentElement.replaceChild(r,l),s.parentElement.replaceChild(o,s),r=this.#r.querySelector("#begin-node"),l=r.firstChild,r.parentElement.replaceChild(l,r);let c=null;if("inline"==this.getElementType(l.parentElement)){let e=this.mainElement(l,this.#h.elementType.inline);c=this.unNestElements(l,a,null,e).focusNode}else c=l;if("inline"!=i)for(;c&&c.parentElement!=n;){let t=c;for(c=c.parentElement,t=t.nextSibling;t;){let n=t;t=t.nextSibling,1==n.nodeType&&this.nodeTreeTagRemover(n,e)}}o=this.#r.querySelector("#end-node"),s=o.firstChild,o.parentElement.replaceChild(s,o);let h=null;if("inline"==this.getElementType(s.parentElement)){let e=this.mainElement(s,this.#h.elementType.inline);h=this.unNestElements(s,d,null,e).focusNode}else h=s;if("inline"!=i)for(;h.parentElement!=n;){let t=h;for(h=h.parentElement,t=t.previousSibling;t;){let n=t;t=t.previousSibling,1==n.nodeType&&this.nodeTreeTagRemover(n,e)}}console.dir(c),console.dir(h);let m=c.nextSibling;if(m&&m!=h)for(;m&&m!=h;){let t=m;m=m.nextSibling,1==t.nodeType&&this.nodeTreeTagRemover(t,e)}}};activateNewLineFeature=e=>{let t=this.getLastRange(),n=e.name,i=["UL","OL"],l=["H1","H2","H3","P"];if(t.collapsed){let e=this.mainElement(t.startContainer,this.#h.elementType.block);if(i.includes(n)){let t=document.createElement(n);if(i.includes(e.nodeName)){for(;e.firstChild;)t.appendChild(e.firstChild);e.parentElement.replaceChild(t,e),this.setCaretPosition(t.lastChild,0)}else if(l.includes(e.nodeName)){let n=document.createElement("LI");for(;e.firstChild;)n.appendChild(e.firstChild);t.appendChild(n),e.parentElement.replaceChild(t,e),this.setCaretPosition(n,0)}else console.log("New feature cant be implemented on custom feature")}else if(l.includes(n))if(i.includes(e.nodeName)){let i=e.nodeName,l=t.startContainer;for(;"LI"!=l.nodeName.toUpperCase();)l=l.parentElement;let r=document.createElement(n);for(;l.firstChild;)r.appendChild(l.firstChild);let a=document.createElement(i);for(;l.previousSibling;)a.childNodes.length?a.insertBefore(l.previousSibling,a.firstChild):a.appendChild(l.previousSibling);let s=document.createElement(i);for(;l.nextSibling;)s.appendChild(l.nextSibling);s.childNodes.length?(e.parentElement.replaceChild(s,e),s.parentElement.insertBefore(r,s)):e.parentElement.replaceChild(r,e),a.childNodes.length&&r.parentElement.insertBefore(a,r),this.setCaretPosition(r,0)}else if(l.includes(e.nodeName)){let t=document.createElement(n);for(;e.firstChild;)t.appendChild(e.firstChild);e.parentElement.replaceChild(t,e),this.setCaretPosition(t,0)}else console.log("New feature cant be implemented on custom feature");else console.log("New feature cant be implemented on custom feature")}else{let e=t.startContainer,r=t.endContainer,a=this.mainElement(e,this.#h.elementType.block),s=this.mainElement(r,this.#h.elementType.block);if(!i.includes(a.nodeName)&&!l.includes(a.nodeName))for(;!i.includes(a.nodeName)&&!l.includes(a.nodeName)&&a!=s;)a=a.nextSibling;if(!i.includes(s.nodeName)&&!l.includes(s.nodeName))for(;!i.includes(s.nodeName)&&!l.includes(s.nodeName)&&s!=a;)s=s.previousSibling;if(a==s){let e=document.createElement(n);for(;a.firstChild;)e.appendChild(a.firstChild);return void a.parentElement.replaceChild(e,a)}if(i.includes(a.nodeName)){let t=e;for(;"LI"!=t.nodeName.toUpperCase();)t=t.parentElement;let n=document.createElement(a.nodeName);for(;t.previousSibling;)n.childNodes.length?n.appendChild(t.previousSibling):n.insertBefore(t.previousSibling,n.firstChild);a.parentElement.insertBefore(n,a)}if(i.includes(s.nodeName)){let e=r;for(;"LI"!=e.nodeName.toUpperCase();)e=e.parentElement;let t=document.createElement(a.nodeName);for(;e.nextSibling;)t.appendChild(e.nextSibling);s.nextSibling?s.parentElement.insertBefore(t,s.nextSibling):s.appendChild(t)}if(i.includes(n)){let e=a,t=document.createElement(n);for(;;){let r=e;if(e=e.nextSibling?e.nextSibling:e,i.includes(r.nodeName)){for(;r.firstChild;)t.appendChild(r.firstChild);r!=s&&r.parentElement.removeChild(r)}else{if(!l.includes(r.nodeName)){t.childNodes.length&&r.parentElement.insertBefore(t,r),t=document.createElement(n);continue}{let e=document.createElement("LI");for(;r.firstChild;)e.appendChild(r.firstChild);t.appendChild(e),r!=s&&r.parentElement.removeChild(r)}}if(r==s){r.parentElement.insertBefore(t,r),r.parentElement.removeChild(r);break}}}else if(l.includes(n)){let e=a;for(;;){let t=e;if(e=e.nextSibling?e.nextSibling:e,i.includes(t.nodeName)){for(;t.firstChild;){let e=t.firstChild,i=document.createElement(n);for(;e.firstChild;)i.appendChild(e.firstChild);t.parentElement.insertBefore(i,t),t.removeChild(e)}t.parentElement.removeChild(t)}else{if(!l.includes(t.nodeName))continue;{let e=document.createElement(n);for(;t.firstChild;)e.appendChild(t.firstChild);t.parentElement.replaceChild(e,t)}}if(t==s)break}}else console.log("New feature cant be implemented on custom feature")}};insertImage=()=>{let e=document.createElement("INPUT");e.type="file",e.click(),e.addEventListener("change",(e=>{if(!e.target.files||1!=e.target.files.length)return console.log("No file selected");let t=e.target.files[0];if(t){let e=new FileReader;e.addEventListener("load",(e=>{let t=e.target.result,n=this.getLastRange(),i=document.createElement("IMG");i.src=t;let l=document.createElement("SPAN");l.contentEditable=!1,l.classList.add("image-container"),l.appendChild(i);let r=document.createElement("div");if(r.contentEditable=!1,r.appendChild(l),n){this.mainElement(n.endContainer,this.#h.elementType.block).insertAdjacentElement("afterend",r)}else this.#r.appendChild(r);let a=document.createElement("p");a.appendChild(document.createElement("br")),r.insertAdjacentElement("afterend",a),i.addEventListener("click",(e=>{this.createImageOptions(e.target),this.clearLastSelection(),this.setActiveFeatures(),this.#d=e.target,this.#o=e.target.nodeName}))})),e.readAsDataURL(t)}}))};openMenuOptions=(e,t=0,n=0)=>{if(e.classList.contains("first-level-item")){let i=this.getElementPosition(e),l=document.createElement("span");return l.classList.add("hide"),l.id="item-sub-menu",l.style.left=i.left+n+"px",l.style.top=i.top+t+"px",this.#l.appendChild(l),l}return null};addTableOptionHandlers=(e,t)=>{let n=t.querySelectorAll("button"),i=t=>{let n=this.getLastRange();["align-left","align-center","align-right"].forEach((t=>{e.classList.contains(t)&&e.classList.remove(t)})),e.classList.add(t),this.setCaretPosition(n.startContainer,n.startOffset)},l=(t=!1)=>{let n=this.getLastRange();if(t)switch(t){case"row":e.classList.contains("header-row")||e.classList.add("header-row");break;case"col":e.classList.contains("header-col")||e.classList.add("header-col")}else e.classList.remove("header-col"),e.classList.remove("header-row");this.setCaretPosition(n.startContainer,n.startOffset)},r=()=>{let t=this.getLastRange(),n=e.querySelectorAll("tr"),i=document.createElement("td");n.forEach((e=>{e.appendChild(i.cloneNode(!0))})),this.setCaretPosition(t.startContainer,t.startOffset)},a=()=>{let t=this.getLastRange(),n=e.querySelector("tr"),i=n.childNodes.length,l=document.createElement("td");n=document.createElement("tr");for(var r=0;r<i;r++)n.appendChild(l.cloneNode());"SPAN"==e.lastChild.nodeName?e.insertBefore(n,e.lastChild):e.appendChild(n),this.setCaretPosition(t.startContainer,t.startOffset)};n.forEach((t=>{switch(t.getAttribute("feature")){case"table-left":t.addEventListener("click",(e=>i("align-left")));break;case"table-center":t.addEventListener("click",(e=>i("align-center")));break;case"table-right":t.addEventListener("click",(e=>i("align-right")));break;case"table-add-col":t.addEventListener("click",(e=>r()));break;case"table-add-row":t.addEventListener("click",(e=>a()));break;case"table-header-row":t.addEventListener("click",(e=>l("row")));break;case"table-header-col":t.addEventListener("click",(e=>l("col")));break;case"table-header-remove":t.addEventListener("click",(e=>l()));break;case"table-close":t.addEventListener("click",(t=>{let n=e.previousElementSibling;e.parentElement.removeChild(e),this.setCaretPosition(n,0)}));break;default:console.log("Unknow table feature passed")}}))};createTableOptions=e=>{let t=e;for(;"TABLE"!=t.nodeName;)t=t.parentElement;if(t.querySelector("span.table-options"))return;this.getElementPosition(t);let n=document.createElement("span");n.contentEditable=!1,n.classList.add("table-options"),t.appendChild(n);let i=document.createElement("SPAN");i.classList.add("custom-feature-divider");let l=document.createElement("BUTTON");l.innerHTML=this.#m.alignLeft,l.setAttribute("feature","table-left"),l.setAttribute("title","Algin left"),n.appendChild(l);let r=document.createElement("BUTTON");r.innerHTML=this.#m.alignCenter,r.setAttribute("feature","table-center"),r.setAttribute("title","Align center"),n.appendChild(r);let a=document.createElement("BUTTON");a.innerHTML=this.#m.alignRight,a.setAttribute("feature","table-right"),a.setAttribute("title","Align right"),n.appendChild(a),n.appendChild(i.cloneNode(!0));let s=document.createElement("BUTTON");s.innerHTML=this.#m.add+" Column",s.setAttribute("feature","table-add-col"),s.setAttribute("title","Add column to table"),n.appendChild(s);let o=document.createElement("BUTTON");o.innerHTML=this.#m.add+" Row",o.setAttribute("feature","table-add-row"),o.setAttribute("title","Add row to table"),n.appendChild(o),n.appendChild(i.cloneNode(!0));let d=document.createElement("BUTTON");d.innerHTML="Header Row",d.setAttribute("feature","table-header-row"),d.setAttribute("title","Add header row to table"),n.appendChild(d);let c=document.createElement("BUTTON");c.innerHTML="Header Column",c.setAttribute("feature","table-header-col"),c.setAttribute("title","Add header column to table"),n.appendChild(c);let h=document.createElement("BUTTON");h.innerHTML="Remove Header",h.setAttribute("feature","table-header-remove"),h.setAttribute("title","Remove table headers"),n.appendChild(h),n.appendChild(i.cloneNode(!0));let m=document.createElement("BUTTON");m.innerHTML=this.#m.close,m.setAttribute("feature","table-close"),m.setAttribute("title","Remove table"),n.appendChild(m),this.addTableOptionHandlers(t,n)};openNewTableOptions=()=>{let e=this.#l.querySelector(".first-level-item.tables-btn"),t=this.openMenuOptions(e,40),n=document.createElement("table");n.classList.add("demo-table");for(let e=0;e<8;e++){let e=document.createElement("tr");for(let t=0;t<8;t++)e.appendChild(document.createElement("td"));n.appendChild(e)}t.appendChild(n),t.classList.remove("hide"),n.querySelectorAll("td").forEach((e=>{e.addEventListener("mouseover",(t=>{let i=e.parentElement,l=i.childNodes.indexOf(e),r=i.parentElement.childNodes.indexOf(i);for(let e=0;e<8;e++)for(let t=0;t<8;t++){let i=n.childNodes[e].childNodes[t];e<=r&&t<=l?i.classList.add("selected"):i.classList.contains("selected")&&i.classList.remove("selected")}})),e.addEventListener("click",(n=>{let i=e.parentElement,l=i.childNodes.indexOf(e),r=i.parentElement.childNodes.indexOf(i),a=this.getLastRange();r++,l++;let s=document.createElement("table");s.classList.add("bordered");for(let e=0;e<r;e++){let e=document.createElement("tr");for(let t=0;t<l;t++){let t=document.createElement("td");e.appendChild(t)}s.appendChild(e)}let o=a.endContainer,d=this.mainElement(o,this.#h.elementType.block),c=document.createElement("p");c.appendChild(document.createElement("br")),d.insertAdjacentElement("afterend",s),s.insertAdjacentElement("afterend",c),s.querySelectorAll("td, th").forEach((e=>{e.addEventListener("click",(e=>{this.createTableOptions(e.target),this.#d=s,this.#o="TABLE"}))})),t.parentElement.removeChild(t)}))}))};applyStyleToElement=(e,t)=>{if(e.type==this.#h.featureType.stylingFeature){let n=[];for(let t in this.#p)this.#p[t].styleCategory==e.styleCategory&&n.push(this.#p[t].styleClass);if("ALIGNMENT"===e.styleCategory)n.forEach((e=>{t.classList.contains(e)&&t.classList.remove(e)})),t.classList.add(e.styleClass)}};applyStyles=e=>{const t=this.getLastRange();if(t.collapsed){if(e.level==this.#h.elementType.block){let n=t.startContainer,i=t.startOffset,l=this.mainElement(n,this.#h.elementType.block);l&&(this.applyStyleToElement(e,l),this.setCaretPosition(n,i))}}else if(e.level==this.#h.elementType.block){let n=t.startContainer;t.startOffset;n=this.mainElement(n,this.#h.elementType.block),this.applyStyleToElement(e,n);let i=t.endContainer;t.endOffset;if(i=this.mainElement(i,this.#h.elementType.block),this.applyStyleToElement(e,i),n!=i){let t=n.nextSibling;for(;t!=i;)t=this.mainElement(t,this.#h.elementType.block),this.applyStyleToElement(e,t),t=t.nextSibling}this.setCaretPosition(n,0)}};changeFeatureState=e=>{let t=null;if(!this.#c)return console.error("Editor was not in focus. No selection found");for(let n of this.#a)if(n.featureName==e){t=n;break}t?this.deActivateFeature(this.#p[e]):this.activateFeature(this.#p[e])};activateFeature=e=>{switch(console.log("Feature activated"),e.type){case this.#h.featureType.inlineFeature:this.insertInlineTag(e.name);break;case this.#h.featureType.newLineFeature:this.activateNewLineFeature(e);break;case this.#h.featureType.customFeature:switch(e.name){case"IMG":this.insertImage();break;case"TABLE":this.openNewTableOptions();break;default:console.error("Unknown custom feature is requested for activation")}break;case this.#h.featureType.stylingFeature:e.level==this.#h.elementType.block?this.applyStyles(e):console.log("Only block level styles are developed till now");break;default:console.error("Unknown feature type")}};deActivateFeature=e=>{switch(console.log("Feature deactivated"),e.type){case this.#h.featureType.inlineFeature:this.removeInlineTag(e.name);break;case this.#h.featureType.newLineFeature:console.log("New Line feature cannot be disabled. It can be toggled with another new line feature");break;case this.#h.featureType.customFeature:case this.#h.featureType.stylingFeature:console.log("Custom Feature cannot be deactivated by menu. It has deactivation option within itself");break;default:console.error("Unknown feature type")}};setActiveFeatures=()=>{let e=this.getLastRange();if(this.#a=[],this.#l.querySelectorAll(".first-level-item").forEach((e=>e.classList.remove("active"))),!e)return console.log("Editor not in focus");if(e.collapsed){let t=e.startContainer;if(t instanceof Node==0)return;for(;t!=this.#r;)1==t.nodeType&&this.setActiceFeatureByElement(t),t=t.parentElement}else{let t=e.cloneContents();this.#a=[];let n=e.startContainer.parentElement,i=this.mainElement(n,this.#h.elementType.block);if(n instanceof Node==0)return;for(;n!=i;)1==n.nodeType&&this.setActiceFeatureByElement(n),n=n.parentElement;if(n=e.endContainer.parentElement,i=this.mainElement(n,this.#h.elementType.block),n instanceof Node==0)return;for(;n!=i;)1==n.nodeType&&this.setActiceFeatureByElement(n),n=n.parentElement;if(n=null,t.childNodes&&t.childNodes.length)for(n of t.childNodes)this.nodeTreeTagChecker(n)}};setActiceFeatureByElement=e=>{if(1!=e.nodeType)return console.error("Only HTML node will be accepted as paramter");this.getLastRange();for(let t in this.#p){let n=this.#p[t];if("object"==typeof n&&n.type){switch(n.type){case this.#h.featureType.inlineFeature:case this.#h.featureType.newLineFeature:if(n&&n.name==e.nodeName&&!this.#a.find((t=>t.nodeName==e.nodeName))){this.#a.push({featureName:t,nodeName:e.nodeName,featureType:n.type});let i=this.#l.querySelector(`.${n.class}`);i.classList.contains("active")||i.classList.add("active")}break;case this.#h.featureType.stylingFeature:let i=this.getElementType(e);if(n.level==this.#h.elementType.block&&"inline"!=i&&e.classList.contains(n.styleClass)&&!this.#a.find((e=>e.nodeName==n.name))){this.#a.push({featureName:t,nodeName:n.name,featureType:n.type});let e=this.#l.querySelector(`.${n.class}`);e.classList.contains("active")||e.classList.add("active")}}}}};nodeTreeTagChecker=e=>{if(1==e.nodeType){for(let t in this.#p){let n=this.#p[t];n&&n.name==e.nodeName&&!this.#a.find((t=>t.nodeName==e.nodeName))&&(this.#a.push({featureName:t,nodeName:e.nodeName,featureType:n.type}),this.#l.querySelector(`.${t}-btn`).classList.add("active"))}if(e.childNodes.length)for(let t of e.childNodes)1==t.nodeType&&this.nodeTreeTagChecker(t)}}}HTMLElement.prototype.texter=function(e){let t={element:this,config:e};return"TEXTAREA"!==t.element.nodeName?console.error("Texter : Given element is not an textarea"):(t.element.style.display="none",!!(window.texter=new Texter(t)))},Node.prototype.properText=function(){let e=this.textContent.trim();return e.length&&(e=e.replace(/\n/g,""),e=e.replace(/\t/g,""),e=e.replace(/\u200b/g,"")),e},NodeList.prototype.indexOf=Array.prototype.indexOf;let testHTML="\n<p>alsdkjasljdlajdlasjdljasldjaslj</p>\n";